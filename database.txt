CREATE DATABASE QuanLyBanHang
GO

USE QuanLyBanHang
GO

-- Bảng nhân viên
CREATE TABLE nhan_vien (
    id_nhan_vien VARCHAR(10) PRIMARY KEY,
    ten_nhan_vien VARCHAR(200),
    tai_khoan VARCHAR(200),
    mat_khau VARCHAR(200),
    ngay_sinh DATE,
    dia_chi VARCHAR(200),
    dien_thoai VARCHAR(200),
    chuc_vu VARCHAR(200),
    id_loai_nhan_vien VARCHAR(10)
)

-- Bảng loại nhân viên
CREATE TABLE loai_nhan_vien (
    id_loai_nhan_vien VARCHAR(10) PRIMARY KEY,
    ten_loai_nhan_vien VARCHAR(200)
)

-- Bảng khách hàng
CREATE TABLE khach_hang (
    id_khach_hang VARCHAR(10) PRIMARY KEY,
    ten_khach_hang VARCHAR(200),
    ngay_sinh DATE,
    dia_chi VARCHAR(200),
    email VARCHAR(200),
    dien_thoai VARCHAR(20),
    tai_khoan VARCHAR(200),
    mat_khau VARCHAR(200)
)

-- Bảng sản phẩm
CREATE TABLE san_pham (
    id_san_pham VARCHAR(10) PRIMARY KEY,
    ten_san_pham VARCHAR(200),
    don_gia FLOAT,
    diem FLOAT,
    hinh VARCHAR(500),
    mo_ta VARCHAR(500),
    id_loai INT
)

-- Bảng loại sản phẩm
CREATE TABLE loai_san_pham (
    id_loai INT PRIMARY KEY,
    ten_loai VARCHAR(200),
    hinh VARCHAR(200)
)

-- Bảng hóa đơn
CREATE TABLE hoa_don (
    id_hoa_don INT PRIMARY KEY,
    id_khach_hang INT,
    ngay_dat DATE,
    ngay_giao_hang DATE,
    tinh_trang_thanh_toan INT,
    phuong_thuc_thanh_toan INT,
    tinh_trang_giao_hang INT,
    tong_tien FLOAT
)

-- Bảng phản hồi
CREATE TABLE phan_hoi (
    id_phan_hoi INT PRIMARY KEY,
    noi_dung_phan_hoi VARCHAR(500),
    ngay_phan_hoi DATE,
    id_khach_hang INT,
    id_san_pham VARCHAR(10)
)

-- Bảng đánh giá
CREATE TABLE danh_gia (
    id_danh_gia INT PRIMARY KEY,
    noi_dung_danh_gia VARCHAR(200),
    diem INT,
    ngay_danh_gia DATE,
    id_khach_hang INT,
    id_san_pham VARCHAR(10)
)

-- Bảng khuyến mãi
CREATE TABLE khuyen_mai (
    id_khuyen_mai INT PRIMARY KEY,
    ten_khuyen_mai VARCHAR(200),
    noi_dung_khuyen_mai VARCHAR(200),
    phan_tram_khuyen_mai INT,
    id_san_pham INT
)

-- Bảng chi tiết hóa đơn
CREATE TABLE chi_tiet_hoa_don (
    id_hoa_don INT,
    id_san_pham INT,
    so_luong INT,
    don_gia FLOAT,
    thanh_tien FLOAT,
    PRIMARY KEY (id_hoa_don, id_san_pham)
)

-- Bảng màn hình
CREATE TABLE DM_ManHinh (
    MaManHinh VARCHAR(10) PRIMARY KEY,
    TenManHinh VARCHAR(200)
)

-- Bảng người dùng
CREATE TABLE QL_NguoiDung (
    TenDangNhap VARCHAR(50) PRIMARY KEY,
    MatKhau VARCHAR(200),
    HoatDong BIT
)

-- Bảng nhóm người dùng
CREATE TABLE QL_NhomNguoiDung (
    MaNhom VARCHAR(10) PRIMARY KEY,
    TenNhom VARCHAR(200),
    GhiChu VARCHAR(500)
)

-- Bảng liên kết giữa người dùng và nhóm người dùng
CREATE TABLE QL_NguoiDungNhomNguoiDung (
    TenDangNhap VARCHAR(50),
    MaNhomNguoiDung VARCHAR(10),
    GhiChu VARCHAR(500),
    PRIMARY KEY (TenDangNhap, MaNhomNguoiDung),
    FOREIGN KEY (TenDangNhap) REFERENCES QL_NguoiDung(TenDangNhap),
    FOREIGN KEY (MaNhomNguoiDung) REFERENCES QL_NhomNguoiDung(MaNhom)
)

-- Bảng phân quyền
CREATE TABLE QL_PhanQuyen (
    MaNhomNguoiDung VARCHAR(10),
    MaManHinh VARCHAR(10),
    CoQuyen BIT,
    PRIMARY KEY (MaNhomNguoiDung, MaManHinh),
    FOREIGN KEY (MaNhomNguoiDung) REFERENCES QL_NhomNguoiDung(MaNhom),
    FOREIGN KEY (MaManHinh) REFERENCES DM_ManHinh(MaManHinh)
)

-- Thêm khóa ngoại cho các bảng
ALTER TABLE nhan_vien
ADD FOREIGN KEY (id_loai_nhan_vien) REFERENCES loai_nhan_vien(id_loai_nhan_vien)

ALTER TABLE san_pham
ADD FOREIGN KEY (id_loai) REFERENCES loai_san_pham(id_loai)

ALTER TABLE hoa_don
ADD FOREIGN KEY (id_khach_hang) REFERENCES khach_hang(id_khach_hang)

ALTER TABLE phan_hoi
ADD FOREIGN KEY (id_khach_hang) REFERENCES khach_hang(id_khach_hang)

ALTER TABLE phan_hoi
ADD FOREIGN KEY (id_san_pham) REFERENCES san_pham(id_san_pham)

ALTER TABLE danh_gia
ADD FOREIGN KEY (id_khach_hang) REFERENCES khach_hang(id_khach_hang)

ALTER TABLE danh_gia
ADD FOREIGN KEY (id_san_pham) REFERENCES san_pham(id_san_pham)

ALTER TABLE khuyen_mai
ADD FOREIGN KEY (id_san_pham) REFERENCES san_pham(id_san_pham)

ALTER TABLE chi_tiet_hoa_don
ADD FOREIGN KEY (id_hoa_don) REFERENCES hoa_don(id_hoa_don)

ALTER TABLE chi_tiet_hoa_don
ADD FOREIGN KEY (id_san_pham) REFERENCES san_pham(id_san_pham)
