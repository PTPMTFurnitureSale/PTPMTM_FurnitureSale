-- Tạo cơ sở dữ liệu
CREATE DATABASE QuanLyBanHang;
GO

USE QuanLyBanHang;
GO

-- Bảng nhân viên
CREATE TABLE nhan_vien (
    id_nhan_vien NVARCHAR(36) PRIMARY KEY,
    ten_nhan_vien NVARCHAR(200),
    tai_khoan NVARCHAR(200),
    mat_khau NVARCHAR(200),
    ngay_sinh DATE,
    dia_chi NVARCHAR(200),
    dien_thoai NVARCHAR(20),
    chuc_vu NVARCHAR(200),
    id_loai_nhan_vien NVARCHAR(36) -- Chỉnh sửa kiểu dữ liệu cho đồng nhất
);

-- Bảng loại nhân viên
CREATE TABLE loai_nhan_vien (
    id_loai_nhan_vien NVARCHAR(36) PRIMARY KEY,
    ten_loai_nhan_vien NVARCHAR(200)
);

-- Bảng khách hàng
CREATE TABLE khach_hang (
    id_khach_hang NVARCHAR(36) PRIMARY KEY,
    ten_khach_hang NVARCHAR(200),
    ngay_sinh DATE,
    dia_chi NVARCHAR(200),
    email NVARCHAR(200),
    dien_thoai NVARCHAR(20),
    tai_khoan NVARCHAR(200),
    mat_khau NVARCHAR(200)
);

-- Bảng sản phẩm
CREATE TABLE san_pham (
    id_san_pham NVARCHAR(36) PRIMARY KEY,
    ten_san_pham NVARCHAR(200),
    don_gia FLOAT,
    diem FLOAT,
    hinh NVARCHAR(500),
    mo_ta NVARCHAR(500),
    id_loai NVARCHAR(36) -- Chỉnh sửa kiểu dữ liệu cho đồng nhất
);

-- Bảng loại sản phẩm
CREATE TABLE loai_san_pham (
    id_loai NVARCHAR(36) PRIMARY KEY,
    ten_loai NVARCHAR(200),
    hinh NVARCHAR(200)
);

-- Bảng hóa đơn
CREATE TABLE hoa_don (
    id_hoa_don INT PRIMARY KEY,
    id_khach_hang NVARCHAR(36),
    ngay_dat DATE,
    ngay_giao_hang DATE,
    tinh_trang_thanh_toan INT,
    phuong_thuc_thanh_toan INT,
    tinh_trang_giao_hang INT,
    tong_tien FLOAT,
    FOREIGN KEY (id_khach_hang) REFERENCES khach_hang(id_khach_hang) -- Khóa ngoại
);

-- Bảng phản hồi
CREATE TABLE phan_hoi (
    id_phan_hoi INT PRIMARY KEY,
    noi_dung_phan_hoi NVARCHAR(500),
    ngay_phan_hoi DATE,
    id_khach_hang NVARCHAR(36),
    id_san_pham NVARCHAR(36),
    FOREIGN KEY (id_khach_hang) REFERENCES khach_hang(id_khach_hang), -- Khóa ngoại
    FOREIGN KEY (id_san_pham) REFERENCES san_pham(id_san_pham) -- Khóa ngoại
);

-- Bảng đánh giá
CREATE TABLE danh_gia (
    id_danh_gia INT PRIMARY KEY,
    noi_dung_danh_gia NVARCHAR(200),
    diem INT,
    ngay_danh_gia DATE,
    id_khach_hang NVARCHAR(36),
    id_san_pham NVARCHAR(36),
    FOREIGN KEY (id_khach_hang) REFERENCES khach_hang(id_khach_hang), -- Khóa ngoại
    FOREIGN KEY (id_san_pham) REFERENCES san_pham(id_san_pham) -- Khóa ngoại
);

-- Bảng khuyến mãi
CREATE TABLE khuyen_mai (
    id_khuyen_mai INT PRIMARY KEY,
    ten_khuyen_mai NVARCHAR(200),
    noi_dung_khuyen_mai NVARCHAR(200),
    phan_tram_khuyen_mai INT,
    id_san_pham NVARCHAR(36),
    FOREIGN KEY (id_san_pham) REFERENCES san_pham(id_san_pham) -- Khóa ngoại
);

-- Bảng chi tiết hóa đơn
CREATE TABLE chi_tiet_hoa_don (
    id_hoa_don INT,
    id_san_pham NVARCHAR(36),
    so_luong INT,
    don_gia FLOAT,
    thanh_tien FLOAT,
    PRIMARY KEY (id_hoa_don, id_san_pham),
    FOREIGN KEY (id_hoa_don) REFERENCES hoa_don(id_hoa_don), -- Khóa ngoại
    FOREIGN KEY (id_san_pham) REFERENCES san_pham(id_san_pham) -- Khóa ngoại
);

-- Bảng màn hình
CREATE TABLE DM_ManHinh (
    MaManHinh NVARCHAR(36) PRIMARY KEY,
    TenManHinh NVARCHAR(200)
);

-- Bảng người dùng
CREATE TABLE QL_NguoiDung (
    TenDangNhap NVARCHAR(50) PRIMARY KEY,
    MatKhau NVARCHAR(200),
    HoatDong BIT
);

-- Bảng nhóm người dùng
CREATE TABLE QL_NhomNguoiDung (
    MaNhom NVARCHAR(36) PRIMARY KEY,
    TenNhom NVARCHAR(200),
    GhiChu NVARCHAR(500)
);

-- Bảng liên kết giữa người dùng và nhóm người dùng
CREATE TABLE QL_NguoiDungNhomNguoiDung (
    TenDangNhap NVARCHAR(50),
    MaNhomNguoiDung NVARCHAR(36),
    GhiChu NVARCHAR(500),
    PRIMARY KEY (TenDangNhap, MaNhomNguoiDung),
    FOREIGN KEY (TenDangNhap) REFERENCES QL_NguoiDung(TenDangNhap),
    FOREIGN KEY (MaNhomNguoiDung) REFERENCES QL_NhomNguoiDung(MaNhom)
);

-- Bảng phân quyền
CREATE TABLE QL_PhanQuyen (
    MaNhomNguoiDung NVARCHAR(36),
    MaManHinh NVARCHAR(36),
    CoQuyen BIT,
    PRIMARY KEY (MaNhomNguoiDung, MaManHinh),
    FOREIGN KEY (MaNhomNguoiDung) REFERENCES QL_NhomNguoiDung(MaNhom),
    FOREIGN KEY (MaManHinh) REFERENCES DM_ManHinh(MaManHinh)
);
GO

-- Thêm một số dữ liệu mẫu vào bảng khách hàng
INSERT INTO khach_hang (
    id_khach_hang,
    ten_khach_hang,
    ngay_sinh,
    dia_chi,
    email,
    dien_thoai,
    tai_khoan,
    mat_khau
) VALUES (
    NEWID(),                         -- id_khach_hang tự động tạo
    'Nguyễn Văn A',                  -- ten_khach_hang
    '1990-01-01',                    -- ngay_sinh
    '123 Đường ABC, Phường X, Quận Y', -- dia_chi
    'nguyenvana@example.com',        -- email
    '0123456789',                    -- dien_thoai
    'nguyenvana',                    -- tai_khoan
    'password123'                    -- mat_khau
);
GO
